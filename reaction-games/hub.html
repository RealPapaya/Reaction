<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å°éŠæˆ²å¤§å»³ - ç²¾é¸åæ‡‰éŠæˆ²é›†åˆ">
    <title>å°éŠæˆ²å¤§å»³ - åæ‡‰éŠæˆ²ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-8);
            position: relative;
        }

        .hub-header {
            text-align: center;
            margin-bottom: var(--space-12);
            position: relative;
        }

        .btn-back {
            position: absolute;
            left: 0;
            top: 0;
            padding: var(--space-2) var(--space-4);
            background: var(--surface);
            border: 3px solid var(--border-color);
            box-shadow: 4px 4px 0 var(--shadow-color);
            font-family: var(--font-display);
            font-weight: var(--font-bold);
            color: var(--text);
            text-decoration: none;
            display: inline-block;
            transition: transform 150ms ease, box-shadow 150ms ease;
        }

        .btn-back:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--shadow-color);
            color: var(--primary);
        }

        .hub-header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            color: var(--primary);
            margin-bottom: var(--space-4);
            text-transform: uppercase;
        }

        .games-grid {
            display: grid;
            gap: var(--space-8);
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {
            .games-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .games-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .game-card {
            background: var(--surface);
            border: 3px solid var(--border-color);
            box-shadow: 8px 8px 0 var(--shadow-color);
            padding: var(--space-8);
            cursor: pointer;
            transition: transform 200ms ease, box-shadow 200ms ease;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .game-card:hover {
            transform: translate(4px, 4px);
            box-shadow: 4px 4px 0 var(--shadow-color);
        }

        .game-card h3 {
            color: var(--primary);
            margin-bottom: var(--space-4);
            font-size: var(--text-2xl);
        }

        .game-card p {
            color: var(--text);
            margin-bottom: var(--space-6);
            flex-grow: 1;
        }

        .game-tag {
            align-self: flex-start;
            background: var(--success);
            color: white;
            padding: var(--space-1) var(--space-2);
            border: 2px solid var(--border-color);
            font-family: var(--font-display);
            font-weight: var(--font-bold);
            font-size: var(--text-xs);
            margin-bottom: var(--space-4);
        }



        /* Leaderboard Button */
        #leaderboard-btn {
            position: fixed;
            top: var(--space-8);
            right: var(--space-8);
            z-index: 100;
            /* Ensure it stays on top */
        }

        @media (max-width: 900px) {
            .hub-header {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: var(--space-4);
            }

            .btn-back {
                position: static;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="hub-header">
            <a href="index.html" class="btn-back">â† è¿”å›é¦–é </a>
            <h1>ğŸ•¹ï¸ å°éŠæˆ²å¤§å»³</h1>
            <p>ç²¾é¸åæ‡‰åŠ›æ¸¬è©¦ï¼ŒæŒ‘æˆ°ä½ çš„æ¥µé™é€Ÿåº¦ï¼</p>
        </header>

        <button id="leaderboard-btn" class="btn btn-primary">ğŸ† æ’è¡Œæ¦œ</button>

        <main>
            <section class="games-grid">
                <!-- Reaction Test Game -->
                <a href="games/reaction-test/index.html" class="game-card">
                    <span class="game-tag">ç¶“å…¸</span>
                    <h3>ç´…ç¶ ç‡ˆåæ‡‰æ¸¬è©¦</h3>
                    <p>ç­‰å¾…ç´…ç‡ˆè½‰ç¶ ï¼Œæ¸¬è©¦ä½ çš„åæ‡‰æœ‰å¤šå¿«ã€‚é»æ“Šå³åˆ»é–‹å§‹æ¸¬è©¦ï¼</p>
                    <div class="btn btn-secondary">ç«‹å³ç©</div>
                </a>

                <!-- Arrow Rush Game -->
                <a href="games/arrow-rush/index.html" class="game-card">
                    <span class="game-tag">æŒ‘æˆ°</span>
                    <h3>ç®­é ­è¡åˆº</h3>
                    <p>30ç§’å…§æŒ‰ä¸‹æ­£ç¢ºçš„æ–¹å‘éµï¼è€ƒé©—ç¯€å¥æ„Ÿèˆ‡æŒ‡å°–æ´»åŠ›çš„å·”å³°å°æ±ºã€‚</p>
                    <div class="btn btn-secondary">ç«‹å³ç©</div>
                </a>

                <!-- Block Lights Game -->
                <a href="games/block-lights/index.html" class="game-card">
                    <span class="game-tag">ç†±é–€</span>
                    <h3>æ–¹å¡Šç‡ˆ</h3>
                    <p>3Ã—3 æ–¹å¡Šç¶²æ ¼ä¸­éš¨æ©Ÿäº®èµ·ï¼Œåœ¨é™æ™‚å…§é»æ“Šè¶Šå¤šè¶Šå¥½ï¼</p>
                    <div class="btn btn-secondary">ç«‹å³ç©</div>
                </a>
            </section>
        </main>


    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content card" style="max-width: 800px;">
            <div class="modal-header">
                <h2 style="margin: 0;">ğŸ† æ’è¡Œæ¦œ</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="leaderboard-tabs-label">é¸æ“‡éŠæˆ²ï¼š</div>
                <div class="leaderboard-tabs" id="hub-leaderboard-tabs">
                    <button class="leaderboard-tab" data-game="reaction-test">ç´…ç¶ ç‡ˆåæ‡‰æ¸¬è©¦</button>
                    <button class="leaderboard-tab" data-game="block-lights">æ–¹å¡Šç‡ˆ</button>
                    <button class="leaderboard-tab" data-game="arrow-rush">ç®­é ­è¡åˆº</button>
                </div>
                <div id="leaderboard-content" style="overflow-x: auto;">
                    <p style="text-align: center;">è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/leaderboard-service.js"></script>
    <script>
        const modal = document.getElementById('leaderboard-modal');
        const btn = document.getElementById('leaderboard-btn');
        const closeBtn = document.querySelector('.close-modal');
        const leaderboardContent = document.getElementById('leaderboard-content');
        const leaderboardTabs = document.querySelectorAll('#hub-leaderboard-tabs .leaderboard-tab');
        const leaderboardCache = {};
        const leaderboardLoading = {};

        btn.addEventListener('click', () => {
            modal.classList.add('show');
            showLeaderboardForGame('reaction-test');
        });

        closeBtn.addEventListener('click', () => {
            modal.classList.remove('show');
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('show');
            }
        });

        leaderboardTabs.forEach(tab => {
            tab.addEventListener('click', () => showLeaderboardForGame(tab.dataset.game));
        });

        function setActiveTab(gameId) {
            leaderboardTabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.game === gameId);
            });
        }

        function renderLeaderboardTable(gameId, scores) {
            if (!scores || scores.length === 0) {
                leaderboardContent.innerHTML = '<p style="text-align: center; color: #666;">å°šç„¡ç´€éŒ„</p>';
                return;
            }

            let html = '<table style="width:100%; border-collapse: collapse; text-align: left; min-width: 400px;">';

            if (gameId === 'reaction-test') {
                html += '<thead><tr style="border-bottom: 3px solid #000;">';
                html += '<th style="padding: var(--space-2);">æ’å</th><th style="padding: var(--space-2);">åå­—</th><th style="padding: var(--space-2); text-align: right;">æ™‚é–“</th></tr></thead><tbody>';
                scores.forEach((s, i) => {
                    html += `<tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: var(--space-2); font-weight: bold;">${i + 1}</td>
                        <td style="padding: var(--space-2);">${s.name}</td>
                        <td style="padding: var(--space-2); text-align: right; font-weight: bold;">${s.score}ms</td>
                    </tr>`;
                });
            } else {
                const countLabel = gameId === 'arrow-rush' ? 'ç®­é ­' : 'æ–¹å¡Š';
                html += '<thead><tr style="border-bottom: 3px solid #000;">';
                html += `<th style="padding: var(--space-2);">æ’å</th><th style="padding: var(--space-2);">åå­—</th><th style="padding: var(--space-2); text-align: right;">${countLabel}</th><th style="padding: var(--space-2); text-align: right;">æ­£ç¢ºç‡</th><th style="padding: var(--space-2); text-align: right;">æœ€é«˜é€£æ“Š</th><th style="padding: var(--space-2); text-align: right;">åˆ†æ•¸</th></tr></thead><tbody>`;
                scores.forEach((s, i) => {
                    const details = s.details ? (typeof s.details === 'string' ? JSON.parse(s.details) : s.details) : {};
                    html += `<tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: var(--space-2); font-weight: bold;">${i + 1}</td>
                        <td style="padding: var(--space-2);">${s.name}</td>
                        <td style="padding: var(--space-2); text-align: right;">${details.count || '-'}</td>
                        <td style="padding: var(--space-2); text-align: right;">${details.accuracy || '-'}</td>
                        <td style="padding: var(--space-2); text-align: right;">${details.maxCombo || '-'}</td>
                        <td style="padding: var(--space-2); text-align: right; font-weight: bold;">${s.score}</td>
                    </tr>`;
                });
            }

            html += '</tbody></table>';
            leaderboardContent.innerHTML = html;
        }

        async function showLeaderboardForGame(gameId) {
            setActiveTab(gameId);
            if (leaderboardCache[gameId]) {
                renderLeaderboardTable(gameId, leaderboardCache[gameId]);
                return;
            }
            if (leaderboardLoading[gameId]) return;
            leaderboardLoading[gameId] = true;
            leaderboardContent.innerHTML = '<p style="text-align: center;">è¼‰å…¥ä¸­...</p>';

            try {
                const scores = await leaderboard.getScores(gameId);
                leaderboardCache[gameId] = scores || [];
                renderLeaderboardTable(gameId, leaderboardCache[gameId]);
            } catch (error) {
                renderLeaderboardTable(gameId, []);
            } finally {
                leaderboardLoading[gameId] = false;
            }
        }

        // Shared Modal Styles (Injection)
        if (!document.getElementById('modal-styles')) {
            const style = document.createElement('style');
            style.id = 'modal-styles';
            style.textContent = `
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.4);
                    backdrop-filter: blur(4px);
                    align-items: center;
                    justify-content: center;
                    padding: var(--space-4);
                }
                .modal.show {
                    display: flex;
                }
                .modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: var(--space-6);
                }
                .close-modal {
                    background: none;
                    border: none;
                    font-size: 2rem;
                    font-weight: bold;
                    cursor: pointer;
                    color: var(--text);
                    padding: 0 var(--space-2);
                    line-height: 1;
                }
                .close-modal:hover {
                    color: var(--error);
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>

</html>
