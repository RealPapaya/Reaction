<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="賽馬競技場 - 真實賽程排程，投注機與兌獎機體驗">
    <title>賽馬競技場 | Reaction Games</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="track-selection-styles.css">
    <link rel="stylesheet" href="ticket-styles.css">
    <link rel="stylesheet" href="machine-styles.css">
    <link rel="stylesheet" href="navigation-styles.css">
    <link rel="stylesheet" href="success-modal-styles.css">
    <link rel="stylesheet" href="screen-transitions.css">
    <link rel="stylesheet" href="shop-styles.css">
</head>

<body>
    <a href="../../index.html" class="global-back-btn">← 返回首頁</a>
    <div class="container">
        <!-- Header -->
        <header class="game-header">
            <h1>🏇 賽馬競技場</h1>
        </header>

        <!-- Main Navigation (Bottom Style) -->
        <nav class="main-nav-bottom">
            <button class="nav-btn-bottom active" data-screen="venues">
                <span class="nav-icon">🏟️</span>
                <span class="nav-label">場地</span>
            </button>
            <button class="nav-btn-bottom" data-screen="betting">
                <span class="nav-icon">📝</span>
                <span class="nav-label">投注機</span>
            </button>
            <button class="nav-btn-bottom" data-screen="shop">
                <span class="nav-icon">🛒</span>
                <span class="nav-label">商店 <span class="balance-chip">$<span id="nav-balance">10000</span></span></span>
            </button>
            <button class="nav-btn-bottom" data-screen="my-bets">
                <span class="nav-icon">📋</span>
                <span class="nav-label">我的投注</span>
            </button>
        </nav>

        <!-- ========================================
             Screen 1: Venues (場地) - Track Cards for Viewing
             ======================================== -->
        <section id="venues-screen" class="screen active">
            <div class="screen-header">
                <h1>🏟️ 賽馬場地</h1>
            </div>
            <div id="venues-cards-container" class="track-cards-grid">
                <!-- Venue cards will be generated here -->
            </div>
        </section>

        <!-- ========================================
             Screen 2: Betting Machine (投注機)
             ======================================== -->
        <section id="betting-screen" class="screen">
            <div class="screen-header">
                <h1>📝 投注機</h1>
            </div>
            <div class="machine-section">
                <h3>選擇賽馬場</h3>
                <div id="betting-track-list" class="track-list">
                    <!-- Track selection buttons -->
                </div>
            </div>
        </section>

        <!-- ========================================
             Screen 3: Shop (商店)
             ======================================== -->
        <section id="shop-screen" class="screen">
            <div class="screen-header">
                <h1>🛒 情報商店</h1>
            </div>

            <div class="shop-content">
                <div class="shop-category">
                    <h3>📰 馬報 (Racing Form)</h3>
                    <p class="category-desc">包含：沙圈觀察、腳質、檔位等內幕消息</p>

                    <div class="product-list" id="racing-form-list">
                        <!-- 動態生成各賽道的馬報 -->
                    </div>
                </div>

                <div class="shop-category disabled">
                    <h3>💡 小道消息 (Insider Tips)</h3>
                    <p class="category-desc">🔒 即將推出</p>
                </div>

                <div class="shop-category disabled">
                    <h3>🌤️ 天氣預報 (Weather Report)</h3>
                    <p class="category-desc">🔒 即將推出</p>
                </div>
            </div>
        </section>

        <!-- ========================================
             Screen 4 (was 3): Balance (餘額) - Hidden
             ======================================== -->
        <section id="balance-screen" class="screen" style="display: none;">
            <div class="screen-header">
                <h1>💰 餘額資訊</h1>
            </div>
            <div class="balance-info-card">
                <div class="balance-main">
                    <div class="balance-label">當前餘額</div>
                    <div class="balance-amount" id="balance-amount">$10,000</div>
                </div>
                <div class="balance-stats">
                    <div class="stat-item">
                        <span class="stat-label">總投注</span>
                        <span class="stat-value" id="total-bet">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">總獲利</span>
                        <span class="stat-value win" id="total-profit">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">勝率</span>
                        <span class="stat-value" id="win-rate">0%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========================================
             Screen 5 (was 4): My Bets (我的投注)
             ======================================== -->
        <section id="my-bets-screen" class="screen">
            <div class="screen-header">
                <h1>📋 我的投注</h1>
            </div>

            <!-- Active Tickets -->
            <div class="bets-section">
                <h3>進行中的投注 <span id="active-count" class="badge">0</span></h3>
                <div id="active-tickets" class="ticket-collection">
                    <p class="no-tickets">暫無進行中的投注</p>
                </div>
            </div>

            <!-- Redeemable Tickets -->
            <div class="bets-section">
                <h3>可兌獎投注單 <span id="redeemable-count" class="badge">0</span></h3>
                <div id="redeemable-tickets" class="ticket-collection">
                    <p class="no-tickets">暫無可兌獎的投注單</p>
                </div>
            </div>

            <!-- History -->
            <div class="bets-section">
                <h3>歷史紀錄</h3>
                <div id="bet-history" class="redemption-history">
                    <p class="no-history">暫無紀錄</p>
                </div>
            </div>
        </section>

        <!-- ========================================
             Betting Detail Screen (投注詳情頁面)
             ======================================== -->
        <section id="betting-detail-screen" class="screen">
            <div class="screen-header">
                <button class="btn btn-secondary" id="back-to-betting">← 返回</button>
                <h2 id="betting-detail-title">雅士谷 - 第 1 場</h2>
            </div>

            <!-- 馬報容器 -->
            <div class="racing-form-container" id="racing-form-container">
                <!-- 未購買時 -->
                <div class="racing-form-locked" id="racing-form-locked">
                    <div class="lock-icon">🔒</div>
                    <p>購買馬報解鎖內幕消息</p>
                    <button class="btn btn-primary" id="buy-form-btn">購買 $50</button>
                </div>

                <!-- 已購買時 -->
                <div class="racing-form-unlocked" id="racing-form-unlocked" style="display: none;">
                    <div class="form-header">
                        <h3>📰 馬報</h3>
                        <button class="form-toggle" id="form-toggle">展開</button>
                    </div>
                    <div class="form-content" id="form-content" style="display: none;">
                        <table class="form-table">
                            <thead>
                                <tr>
                                    <th>馬號</th>
                                    <th>馬名</th>
                                    <th>腳質</th>
                                    <th>檔位</th>
                                    <th>沙圈觀察</th>
                                </tr>
                            </thead>
                            <tbody id="form-table-body">
                                <!-- 動態生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="betting-horses-container" class="betting-detail-container">
                <!-- Horses table will be rendered here -->
            </div>
        </section>

        <!-- Scanning Overlay -->
        <div id="scanning-overlay" class="scanning-overlay hidden">
            <div class="scanning-content">
                <div class="scanning-message" id="scanning-message">正在掃描...</div>
                <div class="scanning-progress">
                    <div class="scanning-progress-bar" id="scanning-progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Race Viewing Modal -->
        <div id="race-modal" class="modal">
            <div class="modal-content card race-modal">
                <div class="modal-header">
                    <h2 id="race-modal-title">雅士谷 - 第 1 場</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="race-status-bar">
                        <span id="race-modal-status" class="status-badge">投注中</span>
                        <span id="race-modal-timer" class="timer-value">05:00</span>
                    </div>
                    <div class="race-track-view">
                        <canvas id="race-canvas" width="1000" height="600"></canvas>
                        <div id="race-waiting" class="race-waiting">
                            <p>⏳ 比賽尚未開始</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Bet Modal -->
        <div id="quick-bet-modal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h2>快速下注</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="horse-info-modal">
                        <h3 id="quick-bet-horse-name">1號 - 閃電俠</h3>
                        <p class="odds-display">賠率: <strong id="quick-bet-odds">3.2x</strong></p>
                    </div>
                    <div class="bet-amount-selector">
                        <label>投注金額：</label>
                        <div class="chip-buttons">
                            <button class="chip-btn" data-amount="100">$100</button>
                            <button class="chip-btn" data-amount="500">$500</button>
                            <button class="chip-btn" data-amount="1000">$1,000</button>
                            <button class="chip-btn" data-amount="5000">$5,000</button>
                        </div>
                        <input type="number" id="quick-bet-amount" placeholder="自訂金額" min="10" step="10">
                    </div>
                    <div class="bet-preview">
                        <p>投注金額: <strong id="quick-bet-preview-amount">$0</strong></p>
                        <p>預期獲利: <strong id="quick-bet-preview-profit">$0</strong></p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary close-modal-btn">取消</button>
                        <button class="btn btn-primary" id="confirm-quick-bet-btn">確認下注</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Notification Modal -->
        <div id="success-modal" class="modal">
            <div class="modal-content card success-notification">
                <div class="modal-header success-header">
                    <h2>✅ 投注成功</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="success-message">
                        <p id="success-ticket-id" class="ticket-id-display"></p>
                        <p class="success-hint">請至「我的投注」查看詳情</p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary close-modal">繼續投注</button>
                        <button class="btn btn-primary" id="go-to-my-bets">查看我的投注</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Track Info Modal -->
        <div id="track-info-modal" class="modal">
            <div class="modal-content card track-detail-modal">
                <div class="modal-header">
                    <h2 id="track-info-name">場地介紹</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="track-info-section">
                        <div class="track-info-header-row">
                            <div class="track-info-image-container" id="track-info-image-container">
                                <img id="track-info-image" src="" alt="Track Image" class="track-info-image hidden">
                            </div>
                            <div class="track-info-text">
                                <div class="track-info-desc" id="track-info-description"></div>
                                <div class="track-info-details">
                                    <div class="info-row">
                                        <span class="info-label">難度評級：</span>
                                        <span class="info-value" id="track-info-difficulty"></span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">地質類型：</span>
                                        <span class="info-value" id="track-info-geology"></span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">賽道特性：</span>
                                        <span class="info-value" id="track-info-characteristics"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="track-info-impact">
                            <h4>核心影響 (Gameplay Impact)：</h4>
                            <ul id="track-info-impact-list"></ul>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary close-modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="racetracks.js"></script>
    <script src="data-generator.js"></script>
    <script src="race-result-generator.js"></script>
    <script src="race-scheduler.js"></script>
    <script src="shop-manager.js"></script>
    <script src="betting-machine.js"></script>
    <script src="redemption-machine.js"></script>
    <script src="race-engine.js"></script>
    <script src="game.js"></script>
</body>

</html>