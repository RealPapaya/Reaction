<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="賽馬競技場 - 真實賽程排程，投注機與兌獎機體驗">
    <title>賽馬競技場 | Reaction Games</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/track-selection-styles.css">
    <link rel="stylesheet" href="css/ticket-styles.css">
    <link rel="stylesheet" href="css/machine-styles.css">
    <link rel="stylesheet" href="css/navigation-styles.css">
    <link rel="stylesheet" href="css/success-modal-styles.css">
    <link rel="stylesheet" href="css/screen-transitions.css">
    <link rel="stylesheet" href="css/shop-styles.css">
    <link rel="stylesheet" href="css/history-schedule-styles.css">
    <style>
        #racing-form-modal .modal-content {
            max-width: 800px;
            /* Wider modal */
            width: 90%;
        }
    </style>
</head>

<body>
    <a href="../../index.html" class="global-back-btn">← 返回首頁</a>
    <div class="coin-display" aria-live="polite">
        <span class="coin-label">金幣</span>
        <span class="coin-value" id="coin-balance">10,000</span>
        <span class="coin-delta" id="coin-delta"></span>
    </div>
    <div class="container">
        <!-- Header -->
        <header class="game-header">
            <h1>🏇 賽馬競技場</h1>
        </header>

        <!-- Main Navigation (Bottom Style) -->
        <nav class="main-nav-bottom">
            <button class="nav-btn-bottom active" data-screen="venues">
                <span class="nav-icon">🏟️</span>
                <span class="nav-label">場地</span>
            </button>
            <button class="nav-btn-bottom" data-screen="betting">
                <span class="nav-icon">📝</span>
                <span class="nav-label">投注機</span>
            </button>
            <button class="nav-btn-bottom" data-screen="shop">
                <span class="nav-icon">🛒</span>
                <span class="nav-label">商店</span>
            </button>
            <button class="nav-btn-bottom" data-screen="my-bets">
                <span class="nav-icon">📋</span>
                <span class="nav-label">我的投注</span>
            </button>
        </nav>

        <!-- ========================================
             Screen 1: Venues (場地) - Track Cards for Viewing
             ======================================== -->
        <section id="venues-screen" class="screen active">
            <div class="screen-header">
                <h1>🏟️ 賽馬場地</h1>
            </div>
            <div id="venues-cards-container" class="track-cards-grid">
                <!-- Venue cards will be generated here -->
            </div>
        </section>

        <!-- ========================================
             Screen 2: Betting Machine (投注機)
             ======================================== -->
        <section id="betting-screen" class="screen">
            <div class="screen-header">
                <h1>📝 投注機</h1>
            </div>
            <div class="machine-section">
                <h3>選擇賽馬場</h3>
                <div id="betting-track-list" class="track-list">
                    <!-- Track selection buttons -->
                </div>
            </div>
        </section>

        <!-- ========================================
             Screen 3: Shop (商店)
             ======================================== -->
        <section id="shop-screen" class="screen">
            <div class="screen-header">
                <h1>🛒 情報商店</h1>
            </div>

            <div class="shop-content">
                <div class="shop-category">
                    <h3>📰 馬報 (Racing Form)</h3>
                    <p class="category-desc">包含：沙圈觀察、腳質、檔位等內幕消息</p>

                    <div class="product-list" id="racing-form-list">
                        <!-- 動態生成各賽道的馬報 -->
                    </div>
                </div>

                <div class="shop-category disabled">
                    <h3>💡 小道消息 (Insider Tips)</h3>
                    <p class="category-desc">🔒 即將推出</p>
                </div>

                <div class="shop-category disabled">
                    <h3>🌤️ 天氣預報 (Weather Report)</h3>
                    <p class="category-desc">🔒 即將推出</p>
                </div>
            </div>
        </section>

        <!-- ========================================
             Screen 4 (was 3): Balance (餘額) - Hidden
             ======================================== -->
        <section id="balance-screen" class="screen" style="display: none;">
            <div class="screen-header">
                <h1>💰 餘額資訊</h1>
            </div>
            <div class="balance-info-card">
                <div class="balance-main">
                    <div class="balance-label">當前餘額</div>
                    <div class="balance-amount" id="balance-amount">$10,000</div>
                </div>
                <div class="balance-stats">
                    <div class="stat-item">
                        <span class="stat-label">總投注</span>
                        <span class="stat-value" id="total-bet">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">總獲利</span>
                        <span class="stat-value win" id="total-profit">$0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">勝率</span>
                        <span class="stat-value" id="win-rate">0%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========================================
             Screen 5 (was 4): My Bets (我的投注)
             ======================================== -->
        <section id="my-bets-screen" class="screen">
            <div class="screen-header">
                <h1>📋 我的投注</h1>
            </div>

            <!-- Active Tickets -->
            <div class="bets-section">
                <h3>進行中的投注 <span id="active-count" class="badge">0</span></h3>
                <div id="active-tickets" class="ticket-collection">
                    <p class="no-tickets">暫無進行中的投注</p>
                </div>
            </div>

            <!-- Redeemable Tickets -->
            <div class="bets-section">
                <h3>可兌獎投注單 <span id="redeemable-count" class="badge">0</span></h3>
                <div id="redeemable-tickets" class="ticket-collection">
                    <p class="no-tickets">暫無可兌獎的投注單</p>
                </div>
            </div>

            <!-- History -->
            <div class="bets-section">
                <h3>歷史紀錄</h3>
                <div id="bet-history" class="redemption-history">
                    <p class="no-history">暫無紀錄</p>
                </div>
            </div>
        </section>

        <!-- ========================================
             Betting Detail Screen (投注詳情頁面)
             ======================================== -->
        <section id="betting-detail-screen" class="screen">
            <div class="screen-header betting-detail-header">
                <button class="btn btn-secondary" id="back-to-betting">← 返回</button>
                <h2 id="betting-detail-title">雅士谷 - 第 1 場</h2>
                <div class="newspaper-indicator" id="newspaper-indicator">
                    <img src="../../assets/News Paper.webp" alt="馬報" class="newspaper-header-icon">
                    <div class="newspaper-label">馬報</div>
                    <div class="newspaper-tooltip" id="newspaper-tooltip">您沒有購買這場的馬報 於情報商店購買</div>
                </div>
            </div>


            <div id="betting-horses-container" class="betting-detail-container">
                <!-- Horses table will be rendered here -->
            </div>
        </section>

        <!-- Scanning Overlay -->
        <div id="scanning-overlay" class="scanning-overlay hidden">
            <div class="scanning-content">
                <div class="scanning-message" id="scanning-message">正在掃描...</div>
                <div class="scanning-progress">
                    <div class="scanning-progress-bar" id="scanning-progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- Race Viewing Modal -->
        <div id="race-modal" class="modal race-modal-container">
            <div class="modal-content card race-modal">
                <button class="fullscreen-close-btn" id="fullscreen-close">&times;</button>
                <div class="modal-header">
                    <h2 id="race-modal-title">雅士谷 - 第 1 場</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="race-status-bar">
                        <span id="race-modal-status" class="status-badge">投注中</span>
                        <span id="race-modal-timer" class="timer-value">05:00</span>
                    </div>
                    <div class="race-track-view">
                        <canvas id="race-canvas" width="1000" height="600"></canvas>
                        <div id="race-waiting" class="race-waiting">
                            <p>⏳ 比賽尚未開始</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Bet Modal -->
        <div id="quick-bet-modal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h2>快速下注</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="horse-info-modal">
                        <h3 id="quick-bet-horse-name">1號 - 閃電俠</h3>
                        <p class="odds-display">賠率: <strong id="quick-bet-odds">3.2x</strong></p>
                    </div>
                    <div class="bet-amount-selector">
                        <label>投注金額：</label>
                        <div class="chip-buttons">
                            <button class="chip-btn" data-amount="100">$100</button>
                            <button class="chip-btn" data-amount="500">$500</button>
                            <button class="chip-btn" data-amount="1000">$1,000</button>
                            <button class="chip-btn" data-amount="5000">$5,000</button>
                        </div>
                        <input type="number" id="quick-bet-amount" placeholder="自訂金額" min="10" step="10">
                    </div>
                    <div class="bet-preview">
                        <p>投注金額: <strong id="quick-bet-preview-amount">$0</strong></p>
                        <p>預期獲利: <strong id="quick-bet-preview-profit">$0</strong></p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary close-modal-btn">取消</button>
                        <button class="btn btn-primary" id="confirm-quick-bet-btn">確認下注</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Notification Modal -->
        <div id="success-modal" class="modal">
            <div class="modal-content card success-notification">
                <div class="modal-header success-header">
                    <h2>✅ 投注成功</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="success-message">
                        <p id="success-ticket-id" class="ticket-id-display"></p>
                        <p class="success-hint">請至「我的投注」查看詳情</p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary close-modal">繼續投注</button>
                        <button class="btn btn-primary" id="go-to-my-bets">查看我的投注</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Track Info Modal -->
        <div id="track-info-modal" class="modal">
            <div class="modal-content card track-detail-modal">
                <div class="modal-header">
                    <h2 id="track-info-name">場地介紹</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="track-info-section">
                        <div class="track-info-header-row">
                            <div class="track-info-image-container" id="track-info-image-container">
                                <img id="track-info-image" src="" alt="Track Image" class="track-info-image hidden">
                            </div>
                            <div class="track-info-text">
                                <div class="track-info-desc" id="track-info-description"></div>
                                <div class="track-info-details">
                                    <div class="info-row">
                                        <span class="info-label">難度評級：</span>
                                        <span class="info-value" id="track-info-difficulty"></span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">地質類型：</span>
                                        <span class="info-value" id="track-info-geology"></span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">賽道特性：</span>
                                        <span class="info-value" id="track-info-characteristics"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="track-info-impact">
                            <h4>核心影響 (Gameplay Impact)：</h4>
                            <ul id="track-info-impact-list"></ul>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary close-modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Racing Form Modal -->
        <div id="racing-form-modal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h2>📰 馬報資訊</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <table class="form-table">
                        <thead>
                            <tr>
                                <th>馬號</th>
                                <th>馬名</th>
                                <th>腳質</th>
                                <th>檔位</th>
                                <th>沙圈觀察</th>
                            </tr>
                        </thead>
                        <tbody id="racing-form-modal-body">
                            <!-- 動態生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 🆕 History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 id="history-modal-title">🏆 歷史紀錄</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="history-records-container" class="records-container">
                    <!-- 動態生成 -->
                </div>
            </div>
        </div>
    </div>


    <!-- 🆕 Schedule Modal -->
    <div id="schedule-modal" class="modal">
        <div class="modal-content card">
            <div class="modal-header">
                <h2 id="schedule-modal-title">📅 賽程表</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="schedule-records-container" class="records-container">
                    <!-- 動態生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 🆕 Replay Modal -->
    <div id="replay-modal" class="modal">
        <div class="modal-content card" style="max-width: 1100px; width: 95%;">
            <div class="modal-header">
                <h2 id="replay-modal-title">🎬 比賽重播</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <canvas id="replay-canvas" width="1000" height="600"
                    style="width: 100%; border: 2px solid #444; border-radius: 8px;"></canvas>

                <div class="replay-controls" style="margin-top: 20px;">
                    <div class="replay-buttons" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button id="replay-play-btn" class="btn btn-primary">▶ 播放</button>
                        <button id="replay-pause-btn" class="btn btn-secondary">⏸ 暫停</button>
                        <button id="replay-restart-btn" class="btn btn-secondary">🔄 重新開始</button>

                        <select id="replay-speed" class="btn" style="margin-left: auto;">
                            <option value="0.25">0.25x</option>
                            <option value="0.5">0.5x</option>
                            <option value="1" selected>1x</option>
                            <option value="2">2x</option>
                            <option value="4">4x</option>
                        </select>
                    </div>

                    <div class="replay-progress" style="position: relative;">
                        <input type="range" id="replay-seek-bar" min="0" max="100" value="0"
                            style="width: 100%; cursor: pointer;">
                        <div id="replay-time" style="text-align: center; margin-top: 5px; font-weight: bold;">00:00 /
                            01:50</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data/racetracks.js"></script>
    <script src="data/data-generator.js"></script>
    <script src="data/race-result-generator.js"></script>
    <script src="js/race-scheduler.js"></script>
    <script src="js/shop-manager.js"></script>
    <script src="js/betting-machine.js"></script>
    <script src="js/redemption-machine.js"></script>
    <!-- 新物理引擎 -->
    <script src="race-engine/core/FrenetCoordinates.js"></script>
    <script src="race-engine/core/PhysicsEngine.js"></script>
    <script src="race-engine/core/SteeringBehaviors.js"></script>
    <script src="race-engine/ai/JockeyAI.js"></script>
    <script src="race-engine/RaceSimulator.js"></script>
    <script src="race-engine/BackgroundSimulator.js"></script>
    <script src="race-engine/RaceEngineAdapter.js"></script>

    <!-- 舊引擎（保留作為備份）-->
    <script src="js/race-engine.js"></script>
    <script src="js/replay-viewer.js"></script>
    <script src="js/game.js"></script>
    <script src="js/history-schedule.js"></script>
</body>

</html>
